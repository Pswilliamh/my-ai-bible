<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My AI Study Bible</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        #bible-text, #notes, #podcast { margin: 20px 0; }
        textarea { width: 100%; height: 100px; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>My AI Study Bible</h1>

    <!-- Bible Text Display -->
    <div id="bible-text">
        <select id="book"><option>Select Book</option></select>
        <select id="chapter"><option>Select Chapter</option></select>
        <button onclick="loadText()">Load Text</button>
        <div id="verse-display"></div>
    </div>

    <!-- AI Search -->
    <div id="ai-search">
        <input type="text" id="search-input" placeholder="Ask a Bible question...">
        <button onclick="aiSearch()">Search with AI</button>
        <div id="search-result"></div>
    </div>

    <!-- Note-Taking -->
    <div id="notes">
        <textarea id="note-input" placeholder="Write your notes here..."></textarea>
        <button onclick="saveNote()">Save Note</button>
        <div id="note-list"></div>
    </div>

    <!-- Podcast Section -->
    <div id="podcast">
        <button onclick="startRecording()">Start Recording</button>
        <button onclick="stopRecording()">Stop Recording</button>
        <div id="podcast-player"></div>
    </div>

    <script>
        // Bible Books
        const books = ["Genesis", "Exodus", "Matthew", "John"];
        const bookSelect = document.getElementById("book");
        books.forEach(book => {
            let option = document.createElement("option");
            option.text = book;
            bookSelect.add(option);
        });

        bookSelect.onchange = () => {
            const chapterSelect = document.getElementById("chapter");
            chapterSelect.innerHTML = "<option>Select Chapter</option>";
            for (let i = 1; i <= 5; i++) {
                let option = document.createElement("option");
                option.text = i;
                chapterSelect.add(option);
            }
        };

        function loadText() {
            const book = document.getElementById("book").value;
            const chapter = document.getElementById("chapter").value;
            fetch(`https://bible-api.com/${book}+${chapter}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById("verse-display").innerHTML = data.text;
                })
                .catch(err => console.log("Error:", err));
        }

        // AI Search
        function aiSearch() {
            const query = document.getElementById("search-input").value.toLowerCase();
            let response = "Hmm, I’m not sure about that yet. Try something else!";
            if (query.includes("jesus")) {
                response = "Jesus is the central figure of Christianity, known as the Son of God. Want to know more about His teachings?";
            } else if (query.includes("love")) {
                response = "Love is a big theme in the Bible! Check out 1 Corinthians 13 for a great passage.";
            } else if (query.includes("genesis")) {
                response = "Genesis is the first book of the Bible, covering creation and the early history of humanity.";
            }
            document.getElementById("search-result").innerHTML = `AI Response: ${response}`;
        }

        // Notes
        function saveNote() {
            const note = document.getElementById("note-input").value;
            let notes = JSON.parse(localStorage.getItem("notes") || "[]");
            notes.push(note);
            localStorage.setItem("notes", JSON.stringify(notes));
            displayNotes();
        }

        function displayNotes() {
            const notes = JSON.parse(localStorage.getItem("notes") || "[]");
            document.getElementById("note-list").innerHTML = notes.map(n => `<p>${n}</p>`).join("");
        }
        displayNotes();

        // Podcast Recording
        let mediaRecorder = null;
        let audioChunks = [];

        function initRecorder() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(audioChunks, { type: "audio/ogg" });
                        const url = URL.createObjectURL(blob);
                        document.getElementById("podcast-player").innerHTML = `<audio controls src="${url}"></audio>`;
                        audioChunks = [];
                    };
                    console.log("Recorder initialized!");
                })
                .catch(err => {
                    console.error("Microphone access failed:", err);
                    alert("Couldn’t access your microphone. Please allow permission and try again.");
                });
        }
        window.onload = initRecorder;

        function startRecording() {
            if (mediaRecorder && mediaRecorder.state !== "recording") {
                audioChunks = [];
                mediaRecorder.start();
                console.log("Recording started!");
            } else {
                alert("Recorder not ready or already recording!");
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                console.log("Recording stopped!");
            } else {
                alert("No active recording to stop!");
            }
        }
    </script>
</body>
</html>
